---
title: "spark data EDA"
author: "Yujie"
date: "12/7/2018"
header-includes:
  \usepackage{array}
  \usepackage{booktabs}
output: beamer_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

## Tasks completed

- Downloaded all interval ION electricity and gas data
- Downloaded a subset of sparks rules data
- Summary statistics of the above

## Energy data (# building downloaded)

\center
```{r energy}
library("dplyr")
library("ggplot2")
dfenergy = readr::read_csv("../data-raw/energy_summary.csv") %>%
{.}
dfenergy %>%
  dplyr::group_by(`variable`) %>%
  dplyr::summarise(`building` = n(), `# with negative reading` = sum(`min`<0)) %>%
  dplyr::ungroup() %>%
  knitr::kable("latex", booktabs = T)
```

## Questions of energy data

- Which should be the correct electricity data? all buildings have "kWh Del Int", some have "kWh del-rec Int" and or "kWh Rec Int". What do they mean? Which one should be used?
- What's the unit for gas?

## Duration of energy data

Most buildings have 4 years of energy data downloaded: 2014 to 2018 Dec.

```{r energy_dur}
dfenergy %>%
  dplyr::mutate(`years`=as.numeric(difftime(`end_date`, `start_date`, unit="weeks")/52.25)) %>%
  ggplot2::ggplot(aes(x=`variable`, y=`years`)) +
  geom_boxplot() +
  theme(text = element_text(size=20))
```

## 2018 Rule data by building

\center
\small
```{r rule}
dfrule = readr::read_csv("../data-raw/rule_summary.csv") %>%
  tibble::as.tibble() %>%
  {.}
sumByBuilding = dfrule %>%
  dplyr::group_by(`building`) %>%
  summarise(`# rules`=n(), count=sum(count), `total cost`=sum(Cost), `total duration`=sum(`duration_hour`)) %>%
  dplyr::ungroup() %>%
  {.}
sumByBuilding %>%
  dplyr::arrange(desc(`total cost`)) %>%
  head(n=15) %>%
  knitr::kable("latex", booktabs = T)
```
\normalsize

## 2018 Rule data by building

\center
\small
```{r rule2}
sumByBuilding %>%
  dplyr::arrange(desc(`total cost`)) %>%
  tail(n=12) %>%
  knitr::kable("latex", booktabs = T)
```
\normalsize

## 2018 Rule data top 10 by # buildings affected

```{r ruleMostBuilding}
sumByRule = dfrule %>%
  dplyr::group_by(`rule`) %>%
  summarise(`# buildings`=n(), count=sum(count), `total cost`=sum(Cost), `total duration`=sum(`duration_hour`)) %>%
  dplyr::ungroup() %>%
  {.}
sumByRule %>%
  dplyr::select(`rule`, `# buildings`) %>%
  dplyr::arrange(desc(`# buildings`)) %>%
  head(n=10) %>%
  knitr::kable("latex", booktabs = T)
```

## 2018 Rule data top 10 by total duration (hour)

```{r ruleMostDuration}
sumByRule %>%
  dplyr::select(`rule`, `total duration`) %>%
  dplyr::arrange(desc(`total duration`)) %>%
  head(n=10) %>%
  knitr::kable("latex", booktabs = T)
```

## 2018 Rule data top 10 by highest cost

```{r ruleMostCost}
sumByRule %>%
  dplyr::select(`rule`, `total cost`) %>%
  dplyr::arrange(desc(`total cost`)) %>%
  head(n=10) %>%
  knitr::kable("latex", booktabs = T)
```